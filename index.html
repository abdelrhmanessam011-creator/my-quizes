<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Medical Writing Quiz 2026 - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(10px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; }
        .theme-transition {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        .text-wrap { word-wrap: break-word; overflow-wrap: break-word; }
        .exam-timer-critical { color: #ef4444; animation: pulse 1s infinite; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 transition-colors duration-300 min-h-screen font-sans overflow-x-hidden theme-transition">

    <div id="app" class="flex flex-col min-h-screen">
        <!-- Header -->
        <header class="bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 sticky top-0 z-20 px-4 py-3 sm:py-4 sm:px-8 shadow-sm">
            <div class="max-w-4xl mx-auto flex items-center justify-between">
                <div class="flex items-center gap-2 sm:gap-3">
                    <div class="bg-indigo-600 dark:bg-indigo-500 p-2 rounded-lg shadow-md">
                        <i class="fas fa-pen-nib text-white text-base sm:text-xl"></i>
                    </div>
                    <div class="block">
                        <h1 class="text-sm sm:text-lg font-bold text-slate-800 dark:text-slate-100 leading-tight">Medical Writing <span id="mode-badge" class="hidden ml-2 px-2 py-0.5 bg-rose-100 text-rose-600 dark:bg-rose-900/40 dark:text-rose-400 rounded text-[10px] uppercase tracking-tighter">Exam Mode</span></h1>
                        <p class="hidden sm:block text-xs text-slate-500 dark:text-slate-400 font-medium">50 Questions Master Bank</p>
                    </div>
                </div>

                <div class="flex items-center gap-3 sm:gap-6">
                    <div class="flex flex-col items-end">
                        <span id="progress-text" class="text-[10px] sm:text-sm font-bold text-indigo-600 dark:text-indigo-400">0%</span>
                        <div class="w-16 sm:w-40 h-1.5 bg-slate-100 dark:bg-slate-800 rounded-full mt-1 overflow-hidden border border-slate-200 dark:border-slate-700">
                            <div id="progress-bar" class="h-full bg-indigo-600 dark:bg-indigo-500 transition-all duration-500 ease-out" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <button onclick="toggleDarkMode()" class="p-2 sm:p-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition-all border border-slate-200 dark:border-slate-700 active:scale-90" aria-label="Toggle Theme">
                        <i id="dark-mode-icon" class="fas fa-sun text-amber-500 dark:text-amber-400"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="quiz-container" class="max-w-4xl mx-auto p-3 sm:p-8 flex-grow w-full relative hidden">
            <div id="quiz-card" class="bg-white dark:bg-slate-900 rounded-2xl sm:rounded-3xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden animate-fade-in relative z-10">
                <div class="px-5 py-3 bg-slate-50 dark:bg-slate-800/50 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center">
                    <span class="text-[10px] sm:text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest">
                        Q <span id="current-q-num" class="text-indigo-600 dark:text-indigo-400">1</span> / <span id="total-q-num">50</span>
                    </span>
                    <span id="timer-wrapper" class="text-xs font-mono font-bold text-slate-400 dark:text-slate-500 flex items-center gap-1.5">
                        <i class="far fa-clock"></i>
                        <span id="timer-display">0:00</span>
                    </span>
                </div>

                <div class="p-5 sm:p-10">
                    <h2 id="question-text" class="text-lg sm:text-2xl font-bold text-slate-800 dark:text-slate-100 mb-6 sm:mb-10 leading-snug">Loading question...</h2>
                    <div id="options-container" class="space-y-3 sm:space-y-4"></div>
                </div>

                <div class="px-5 py-5 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-800 flex items-center justify-between gap-3">
                    <button id="prev-btn" onclick="prevQuestion()" class="flex items-center justify-center gap-2 px-4 py-3 rounded-xl font-bold transition-all text-slate-600 dark:text-slate-400 hover:bg-white dark:hover:bg-slate-800 hover:text-indigo-600 disabled:opacity-30 disabled:cursor-not-allowed text-sm">
                        <i class="fas fa-chevron-left"></i> <span class="hidden sm:inline">Previous</span>
                    </button>
                    <button id="action-btn" onclick="handleAction()" class="flex-grow sm:flex-grow-0 sm:px-12 py-3 sm:py-4 bg-indigo-600 text-white rounded-xl sm:rounded-2xl font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 dark:shadow-none active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base">
                        Check Answer
                    </button>
                </div>
            </div>

            <!-- Stats -->
            <div id="stats-container" class="mt-6 grid grid-cols-3 gap-3 sm:gap-6">
                <div class="bg-white dark:bg-slate-900 p-3 sm:p-5 rounded-xl sm:rounded-2xl border border-slate-200 dark:border-slate-800 flex flex-col sm:flex-row items-center sm:items-start gap-1 sm:gap-4 shadow-sm">
                    <div class="bg-emerald-50 dark:bg-emerald-900/30 p-2 sm:p-3 rounded-lg text-emerald-600"><i class="fas fa-check-circle text-sm sm:text-xl"></i></div>
                    <div class="text-center sm:text-left"><p class="text-[9px] sm:text-xs font-bold text-slate-500 uppercase">Correct</p><p id="score-display" class="text-sm sm:text-2xl font-black text-slate-900 dark:text-slate-100 leading-none">0</p></div>
                </div>
                <div class="bg-white dark:bg-slate-900 p-3 sm:p-5 rounded-xl sm:rounded-2xl border border-slate-200 dark:border-slate-800 flex flex-col sm:flex-row items-center sm:items-start gap-1 sm:gap-4 shadow-sm">
                    <div class="bg-indigo-50 dark:bg-indigo-900/30 p-2 sm:p-3 rounded-lg text-indigo-600"><i class="fas fa-list-ol text-sm sm:text-xl"></i></div>
                    <div class="text-center sm:text-left"><p class="text-[9px] sm:text-xs font-bold text-slate-500 uppercase">Left</p><p id="remaining-display" class="text-sm sm:text-2xl font-black text-slate-900 dark:text-slate-100 leading-none">50</p></div>
                </div>
                <div class="bg-white dark:bg-slate-900 p-3 sm:p-5 rounded-xl sm:rounded-2xl border border-slate-200 dark:border-slate-800 flex flex-col sm:flex-row items-center sm:items-start gap-1 sm:gap-4 shadow-sm">
                    <div class="bg-amber-50 dark:bg-amber-900/30 p-2 sm:p-3 rounded-lg text-amber-600"><i class="fas fa-percentage text-sm sm:text-xl"></i></div>
                    <div class="text-center sm:text-left"><p class="text-[9px] sm:text-xs font-bold text-slate-500 uppercase">Acc.</p><p id="accuracy-display" class="text-sm sm:text-2xl font-black text-slate-900 dark:text-slate-100 leading-none">0%</p></div>
                </div>
            </div>
        </main>

        <!-- Setup Modal -->
        <div id="setup-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-md animate-fade-in p-4">
            <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-8 max-w-sm w-full border border-slate-200 dark:border-slate-700 text-center">
                <div class="w-16 h-16 bg-indigo-100 dark:bg-indigo-900/50 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-graduation-cap text-3xl text-indigo-600 dark:text-indigo-400"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-3">Quiz Mode Selection</h2>
                <p class="text-slate-600 dark:text-slate-400 mb-8 text-sm">Choose how you want to test your medical writing knowledge.</p>
                
                <div class="space-y-3">
                    <button onclick="requestStartPoint()" class="w-full py-4 bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 hover:border-indigo-500 dark:hover:border-indigo-500 text-slate-700 dark:text-slate-200 rounded-xl font-bold transition-all flex items-center justify-center gap-3 group">
                        <i class="fas fa-sort-numeric-down text-slate-400 group-hover:text-indigo-500 transition-colors"></i> Standard (1-50)
                    </button>
                    <button onclick="startQuiz('shuffle')" class="w-full py-4 bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 hover:border-indigo-500 dark:hover:border-indigo-500 text-slate-700 dark:text-slate-200 rounded-xl font-bold transition-all flex items-center justify-center gap-3 group">
                        <i class="fas fa-random text-slate-400 group-hover:text-indigo-500 transition-colors"></i> Randomized Practice
                    </button>
                    <button onclick="startQuiz('exam')" class="w-full py-4 bg-rose-600 hover:bg-rose-700 text-white rounded-xl font-bold transition-all shadow-lg shadow-rose-200 dark:shadow-none flex items-center justify-center gap-3">
                        <i class="fas fa-stopwatch"></i> Timed Exam (15m)
                    </button>
                </div>
            </div>
        </div>

        <!-- Start Point Picker Modal -->
        <div id="start-picker-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 backdrop-blur-md hidden animate-fade-in p-4">
            <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-8 max-w-sm w-full border border-slate-200 dark:border-slate-700 text-center">
                <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2">Select Starting Point</h3>
                <p class="text-slate-600 dark:text-slate-400 text-sm mb-6">Enter question number (1-50):</p>
                
                <div class="flex gap-2 mb-6">
                    <input type="number" id="start-q-input" min="1" max="50" value="1" class="w-full bg-slate-50 dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-center text-xl font-bold focus:border-indigo-500 outline-none transition-all">
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <button onclick="closeStartPicker()" class="py-3 px-4 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 rounded-xl font-bold hover:bg-slate-200 transition-all">
                        Back
                    </button>
                    <button onclick="confirmStartPoint()" class="py-3 px-4 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 dark:shadow-none">
                        Start Quiz
                    </button>
                </div>
            </div>
        </div>

        <!-- Review Modal -->
        <div id="repeat-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm hidden animate-fade-in p-4">
            <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl p-6 max-w-sm w-full border border-slate-200 dark:border-slate-700 transform scale-100 transition-all">
                <div class="text-center">
                    <div class="inline-flex items-center justify-center w-14 h-14 rounded-full bg-amber-100 dark:bg-amber-900/30 mb-4 animate-bounce">
                        <i class="fas fa-redo text-amber-600 dark:text-amber-400 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2">Review Needed?</h3>
                    <p class="text-slate-600 dark:text-slate-400 text-sm mb-6 leading-relaxed">
                        You answered this question incorrectly. Would you like to add it to the end of the quiz to try again later?
                    </p>
                    
                    <div class="flex flex-col gap-3">
                        <button onclick="confirmRepeat()" class="w-full py-3.5 px-4 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold transition-all shadow-lg shadow-indigo-200 dark:shadow-none active:scale-95 flex items-center justify-center gap-2">
                            <i class="fas fa-history"></i> Repeat Later
                        </button>
                        <button onclick="skipRepeat()" class="w-full py-3.5 px-4 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 rounded-xl font-semibold transition-all active:scale-95">
                            Skip & Continue
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Results -->
        <div id="results-screen" class="hidden max-w-4xl mx-auto p-4 sm:p-8 animate-slide-up w-full">
            <div class="max-w-md mx-auto bg-white dark:bg-slate-900 rounded-3xl shadow-xl border border-slate-200 dark:border-slate-800 overflow-hidden theme-transition">
                <div id="results-header" class="bg-indigo-600 dark:bg-indigo-500 p-6 sm:p-8 text-center text-white">
                    <i class="fas fa-award text-5xl sm:text-6xl mb-4 text-white/90"></i>
                    <h1 class="text-2xl sm:text-3xl font-bold">Quiz Complete!</h1>
                    <p class="text-indigo-100 text-sm mt-2">Questions Mastered</p>
                </div>
                <div class="p-6 sm:p-8 space-y-4 sm:space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-indigo-50 dark:bg-slate-800 p-4 rounded-2xl text-center border border-indigo-100 dark:border-slate-700">
                            <p class="text-indigo-600 dark:text-indigo-400 text-[10px] font-bold uppercase mb-1">Total Score</p>
                            <p id="final-score" class="text-2xl sm:text-3xl font-bold text-indigo-900 dark:text-slate-100">0</p>
                        </div>
                        <div class="bg-indigo-50 dark:bg-slate-800 p-4 rounded-2xl text-center border border-indigo-100 dark:border-slate-700">
                            <p class="text-indigo-600 dark:text-indigo-400 text-[10px] font-bold uppercase mb-1">Accuracy</p>
                            <p id="final-accuracy" class="text-2xl sm:text-3xl font-bold text-indigo-900 dark:text-slate-100">0%</p>
                        </div>
                    </div>
                    <div id="exam-status-msg" class="hidden p-4 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 text-center text-sm font-medium"></div>
                    <button onclick="restartApp()" class="w-full py-4 bg-indigo-600 dark:bg-indigo-500 text-white rounded-xl sm:rounded-2xl font-bold hover:bg-indigo-700 transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-redo"></i> Return to Menu
                    </button>
                </div>
            </div>
        </div>

        <footer class="max-w-4xl mx-auto py-8 sm:py-12 text-center text-slate-400 dark:text-slate-600 text-[10px] sm:text-sm font-semibold px-4 theme-transition">
            <div class="flex items-center justify-center gap-2 mb-2">
                <i class="fas fa-book-open opacity-50"></i>
                <span>Medical Writing Unified Quiz Bank</span>
            </div>
            <p>Â© 2026 Academic Resources</p>
        </footer>
    </div>

    <script>
        const QUESTIONS_DATA = [
            { id: 1, question: "What is the primary definition of medical writing according to the sources?", options: ["Creative storytelling about medical experiences.", "Creating scientific documents that communicate medical information clearly and accurately.", "Writing prescriptions and medical orders only.", "Journalism focused on health insurance policies."], answer: 1 },
            { id: 2, question: "Which 11th-century Arabic text became a staple in Eastern and Western medical schools for centuries?", options: ["The Hippocratic Corpus.", "The Lancet.", "Avicenna's Canon of Medicine.", "The British Medical Journal."], answer: 2 },
            { id: 3, question: "What are the three pillars of effective medical writing?", options: ["Speed, Complexity, and Volume.", "Accuracy, Clarity, and Structure.", "Jargon, Data, and Length.", "Emotion, Persuasion, and Creativity."], answer: 1 },
            { id: 4, question: "According to the sources, writing is a clinical skill comparable to:", options: ["Performing complex neurosurgery.", "Taking a patient's history or interpreting an ECG.", "Hospital administration.", "Medical coding."], answer: 1 },
            { id: 5, question: "What does the source suggest regarding the use of medical jargon?", options: ["It should be used as much as possible to sound professional.", "It should be avoided unless the audience is trained to understand it.", "It is never appropriate in medical writing.", "It is only useful for social media."], answer: 1 },
            { id: 6, question: "Which principle is considered the \"Ethical Backbone\" of medical writing?", options: ["Clarity.", "Structure.", "Accuracy.", "Audience-Specificity."], answer: 2 },
            { id: 7, question: "If a student writes \"Type 1 diabetes controlled with metformin,\" they are failing which core principle?", options: ["Structure.", "Accuracy.", "Guideline adherence.", "Language evolution."], answer: 1 },
            { id: 8, question: "The \"5 C's Framework\" in patient education writing includes Clear, Concise, Consistent, Culturally Sensitive, and:", options: ["Clinical.", "Comprehensive.", "Caring.", "Complex."], answer: 2 },
            { id: 9, question: "When writing for patients, what is the recommended reading level?", options: ["Grade 12 or higher.", "Graduate level.", "Grade 6-8.", "Kindergarten level."], answer: 2 },
            { id: 10, question: "The shift from the term \"compliance\" to \"adherence\" reflects a focus on:", options: ["Financial goals.", "Partnership over authority.", "Stricter rules for patients.", "Simplified spelling."], answer: 1 },
            { id: 11, question: "The standard structure for most formal scientific papers is known as:", options: ["SOAP.", "CARE.", "IMRAD.", "PRISMA."], answer: 2 },
            { id: 12, question: "In the IMRAD model, which section answers the question \"Why did we do this?\"", options: ["Methods.", "Results.", "Introduction.", "Discussion."], answer: 2 },
            { id: 13, question: "What is the main goal of the Methods section in a scientific paper?", options: ["To interpret the results for the reader.", "To allow another researcher to replicate the study exactly.", "To provide a long literature review.", "To list all authors' affiliations."], answer: 1 },
            { id: 14, question: "Which section of a scientific paper transforms results into meaning and explains their implications?", options: ["Results.", "Methods.", "Discussion.", "Abstract."], answer: 2 },
            { id: 15, question: "What is \"Data Fabrication\"?", options: ["Rewording a sentence from another paper.", "Making up results that never existed.", "Omitting a citation by mistake.", "Translating data into another language."], answer: 1 },
            { id: 16, question: "What is the purpose of MeSH (Medical Subject Headings)?", options: ["To check for grammar errors.", "To provide standardized indexing terms for research discoverability.", "To list all medical school faculty.", "To write catchy titles for social media."], answer: 1 },
            { id: 17, question: "A \"Double-blind\" peer review means:", options: ["The editor does not know the author or the reviewer.", "Neither the authors nor the reviewers know each other's identities.", "The reviewer is blindfolded during the process.", "The paper is reviewed by two different journals simultaneously."], answer: 1 },
            { id: 18, question: "The International Committee of Medical Journal Editors (ICMJE) requires how many criteria to be met for authorship?", options: ["One.", "Two.", "Three.", "Four."], answer: 3 },
            { id: 19, question: "Which guideline is specifically used for reporting case reports?", options: ["PRISMA.", "CONSORT.", "CARE.", "STROBE."], answer: 2 },
            { id: 20, question: "In a systematic review, what does the \"P\" in PICO stand for?", options: ["Plan.", "Patient/Problem.", "Procedure.", "Publication."], answer: 1 },
            { id: 21, question: "What is a Meta-analysis?", options: ["A short summary of a single case.", "A descriptive overview of vaccine mechanisms.", "A statistical combination of results from multiple studies.", "A review of medical history."], answer: 2 },
            { id: 22, question: "What is the \"Golden Rule\" for abstracts?", options: ["Use as many abbreviations as possible.", "Write it first before the paper.", "Write it last after completing the paper.", "Include at least five references."], answer: 2 },
            { id: 23, question: "Which tool is used to visualize pooled effects in a meta-analysis?", options: ["Funnel plot.", "Pie chart.", "Forest plot.", "Bar graph."], answer: 2 },
            { id: 24, question: "\"Mosaic plagiarism\" involves:", options: ["Reusing your own previously published work.", "Mixing someone else's words with your own while keeping their structure.", "Copying a chart exactly.", "Fabricating patient data."], answer: 1 },
            { id: 25, question: "The 10-20-30 Rule for presentations suggests 10 slides, 20 minutes, and:", options: ["30 references.", "30 images.", "30-point font.", "30 audience members."], answer: 2 },
            { id: 26, question: "What is the primary purpose of clinical documentation?", options: ["To increase hospital revenue.", "To ensure continuity of care and legal accuracy.", "To practice creative writing.", "To replace patient interaction."], answer: 1 },
            { id: 27, question: "In a SOAP note, where would you document the patient's chief complaint in their own words?", options: ["Subjective.", "Objective.", "Assessment.", "Plan."], answer: 0 },
            { id: 28, question: "In which SOAP section would you find measurable findings like \"BP 138/82 mmHg\"?", options: ["Subjective.", "Objective.", "Assessment.", "Plan."], answer: 1 },
            { id: 29, question: "The Assessment section of a SOAP note is used to:", options: ["Record the history of present illness.", "List future laboratory tests.", "Synthesize data into clinical meaning or a diagnosis.", "Note the patient's insurance details."], answer: 2 },
            { id: 30, question: "What is the legal assumption regarding medical documentation?", options: ["If it's written, it must be true.", "If it's not written, it wasn't done.", "Patients are not allowed to read their own notes.", "Handwriting is more credible than typed notes."], answer: 1 },
            { id: 31, question: "Which of the following is a common SOAP pitfall?", options: ["Using too few abbreviations.", "Copying and pasting from old notes without updating.", "Signing the note with your credentials.", "Recording only observed facts."], answer: 1 },
            { id: 32, question: "When correcting an error in a paper medical record, you should:", options: ["Use correction fluid to hide the error.", "Scribble over it until it is unreadable.", "Draw a single line through it, mark \"error,\" and initial.", "Throw the page away and start over."], answer: 2 },
            { id: 33, question: "What is a significant advantage of Electronic Medical Records (EMRs)?", options: ["They prevent all medical errors.", "They offer decision support alerts for drug interactions.", "They are faster to use than drawing diagrams by hand.", "They eliminate the need for clinical reasoning."], answer: 1 },
            { id: 34, question: "\"Chart cloning\" refers to:", options: ["Making a backup copy of a file.", "Propagating outdated data via copy-paste in EMRs.", "Giving the same diagnosis to multiple patients.", "Translating a chart into another language."], answer: 1 },
            { id: 35, question: "When should a medical note ideally be written?", options: ["At the end of the week.", "Immediately after the patient encounter.", "Only if the patient complains.", "After the patient is discharged."], answer: 1 },
            { id: 36, question: "Which platform is described as a hub for research updates and academic dialogue?", options: ["Instagram.", "TikTok.", "Twitter/X.", "Facebook."], answer: 2 },
            { id: 37, question: "What is the primary focus of medical writing on Instagram?", options: ["Long-form research papers.", "Professional networking for jobs.", "Visuals, infographics, and reels.", "Encrypted messaging."], answer: 2 },
            { id: 38, question: "The E-A-R framework for managing misinformation stands for:", options: ["Evaluate, Analyze, Report.", "Empathize, Address, Refer.", "Edit, Authorize, Release.", "Engage, Argue, Refute."], answer: 1 },
            { id: 39, question: "Which of the following is a \"Don't\" for professional social media content?", options: ["Citing credible sources.", "Posting identifiable patient photos without consent.", "Maintaining a professional tone.", "Using hashtags like #MedEd."], answer: 1 },
            { id: 40, question: "How does the source suggest handling personal vs. professional social media accounts?", options: ["They should always be mixed to show authenticity.", "Keep them 100% personal only.", "Avoid mixing them in ways that blur ethical boundaries.", "Only use professional accounts."], answer: 2 },
            { id: 41, question: "What is the \"Medical Writer's Role\" in AR/VR health education?", options: ["Designing the 3D software code.", "Scripting scenarios, voice-overs, and instructional guides.", "Selling the hardware to hospitals.", "Testing the equipment for physical safety."], answer: 1 },
            { id: 42, question: "In medical translation, what is \"Back translation\"?", options: ["Translating from the end of the document to the beginning.", "Translating to a target language, then back to the original to compare meaning.", "Translating only the background section.", "Using Google Translate for everything."], answer: 1 },
            { id: 43, question: "What is an ethical guardrail for using AI in medical writing?", options: ["AI should replace human writers to save time.", "AI suggestions must be reviewed by trained professionals.", "Never disclose that AI was used.", "AI should generate all the research data."], answer: 1 },
            { id: 44, question: "A freelance medical writer's work is typically:", options: ["Fixed schedule in a hospital.", "Project-based with global clients.", "Focused only on surgery.", "Unpaid volunteering."], answer: 1 },
            { id: 45, question: "Which organization offers certifications for medical writers in Europe?", options: ["WHO.", "EMWA.", "CDC.", "HIPAA."], answer: 1 },
            { id: 46, question: "\"Imposter Syndrome\" in medical writing is defined as:", options: ["Pretending to be a doctor online.", "Feeling unqualified despite having medical training.", "Using someone else's name on a paper.", "Forgetting medical terminology."], answer: 1 },
            { id: 47, question: "What is the \"Writer's Oath\" core message?", options: ["Publish as many papers as possible.", "Communicate truthfully and educate with empathy.", "Avoid writing for patients.", "Use the most complex words possible."], answer: 1 },
            { id: 48, question: "When working with translators, a medical writer should:", options: ["Use machine translation without review.", "Provide a glossary of key terms.", "Avoid checking the final draft.", "Translate word-for-word literally."], answer: 1 },
            { id: 49, question: "In the future (2035), medical communication is expected to be:", options: ["Only on paper.", "Immersive and predictive.", "Controlled by a single global agency.", "Performed only by AI."], answer: 1 },
            { id: 50, question: "The purpose of the book is to show that medical writing is:", options: ["Only for professional authors.", "An \"extra\" work of medicine.", "The evidence that medicine was done.", "A way to avoid clinical duties."], answer: 2 }
        ];

        // App state
        let questionsList = []; 
        let currentIndex = 0;
        let selectedOption = null;
        let isAnswerChecked = false;
        let score = 0;
        let userAnswers = []; 
        let repeatHandled = []; // Tracks if the repeat/skip modal has been processed for this index
        let timer = 0;
        let timerInterval;
        let isExamMode = false;
        const EXAM_TIME_LIMIT = 900; // 15 minutes

        function requestStartPoint() {
            document.getElementById('start-picker-modal').classList.remove('hidden');
        }

        function closeStartPicker() {
            document.getElementById('start-picker-modal').classList.add('hidden');
        }

        function confirmStartPoint() {
            let val = parseInt(document.getElementById('start-q-input').value);
            if (isNaN(val) || val < 1) val = 1;
            if (val > 50) val = 50;
            
            document.getElementById('start-picker-modal').classList.add('hidden');
            startQuiz('order', val);
        }

        function startQuiz(mode, startAt = 1) {
            isExamMode = (mode === 'exam');
            questionsList = [...QUESTIONS_DATA];
            
            if (mode === 'shuffle' || mode === 'exam') {
                for (let i = questionsList.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [questionsList[i], questionsList[j]] = [questionsList[j], questionsList[i]];
                }
            }

            currentIndex = startAt - 1; // Zero-based
            selectedOption = null;
            isAnswerChecked = false;
            score = 0;
            userAnswers = new Array(questionsList.length).fill(null);
            repeatHandled = new Array(questionsList.length).fill(false);
            
            // Set Timer
            if (isExamMode) {
                timer = EXAM_TIME_LIMIT;
                document.getElementById('mode-badge').classList.remove('hidden');
                document.getElementById('stats-container').classList.add('opacity-30', 'pointer-events-none');
            } else {
                timer = 0;
                document.getElementById('mode-badge').classList.add('hidden');
                document.getElementById('stats-container').classList.remove('opacity-30', 'pointer-events-none');
            }

            document.getElementById('setup-modal').classList.add('hidden');
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('total-q-num').innerText = questionsList.length;
            
            startTimer();
            renderQuestion();
            updateStats();
        }

        function restartApp() {
            clearInterval(timerInterval);
            document.getElementById('results-screen').classList.add('hidden');
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('setup-modal').classList.remove('hidden');
        }

        function startTimer() {
            clearInterval(timerInterval);
            const display = document.getElementById('timer-display');
            const wrapper = document.getElementById('timer-wrapper');
            wrapper.classList.remove('exam-timer-critical');

            timerInterval = setInterval(() => {
                if (isExamMode) {
                    timer--;
                    if (timer <= 60) wrapper.classList.add('exam-timer-critical');
                    if (timer <= 0) {
                        clearInterval(timerInterval);
                        finishQuiz();
                        return;
                    }
                } else {
                    timer++;
                }
                display.innerText = formatTime(timer);
            }, 1000);
        }

        function formatTime(seconds) {
            const mins = Math.floor(Math.abs(seconds) / 60);
            const secs = Math.abs(seconds) % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function renderQuestion() {
            const question = questionsList[currentIndex];
            const progress = ((currentIndex + 1) / questionsList.length) * 100;
            
            document.getElementById('question-text').innerText = question.question;
            document.getElementById('current-q-num').innerText = currentIndex + 1;
            document.getElementById('total-q-num').innerText = questionsList.length;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').innerText = `${Math.round(progress)}%`;
            document.getElementById('prev-btn').disabled = currentIndex === 0;

            const container = document.getElementById('options-container');
            container.innerHTML = '';

            const savedAnswer = userAnswers[currentIndex];
            if (savedAnswer !== null && savedAnswer !== undefined) {
                isAnswerChecked = true;
                selectedOption = savedAnswer;
            }

            question.options.forEach((option, idx) => {
                const isSelected = selectedOption === idx;
                const isCorrect = question.answer === idx;
                
                let classes = "group w-full text-left p-4 sm:p-5 rounded-xl sm:rounded-2xl border-2 transition-all flex items-center justify-between relative active:scale-[0.98] cursor-pointer ";
                
                if (isAnswerChecked && !isExamMode) {
                    classes += "cursor-default ";
                    if (isCorrect) {
                        classes += "bg-emerald-50 dark:bg-emerald-950/30 border-emerald-500 text-emerald-900 dark:text-emerald-300";
                    } else if (isSelected) {
                        classes += "bg-rose-50 dark:bg-rose-950/30 border-rose-500 text-rose-900 dark:text-rose-300";
                    } else {
                        classes += "bg-white dark:bg-slate-900 border-slate-100 dark:border-slate-800 text-slate-400 dark:text-slate-600 opacity-60";
                    }
                } else if (isAnswerChecked && isExamMode) {
                    classes += isSelected 
                        ? "bg-indigo-50 dark:bg-indigo-900/30 border-indigo-500 text-indigo-900 dark:text-indigo-300 shadow-md" 
                        : "bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 text-slate-300 dark:text-slate-700 opacity-50";
                } else {
                    classes += isSelected 
                        ? "bg-indigo-50 dark:bg-indigo-900/30 border-indigo-500 text-indigo-900 dark:text-indigo-300 shadow-md" 
                        : "bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800 hover:border-indigo-300 text-slate-700 dark:text-slate-300";
                }

                const button = document.createElement('button');
                button.className = classes;
                button.disabled = isAnswerChecked;
                button.onclick = () => selectOption(idx);

                const leftSide = `
                    <span class="flex items-center gap-3 sm:gap-4">
                        <span class="flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 rounded-lg sm:rounded-xl flex items-center justify-center text-xs sm:text-sm font-bold border transition-colors ${isSelected ? 'bg-indigo-600 border-indigo-600 text-white' : 'bg-slate-100 dark:bg-slate-800 border-slate-200 dark:border-slate-700 text-slate-500'}">
                            ${String.fromCharCode(65 + idx)}
                        </span>
                        <span class="font-semibold text-sm sm:text-lg text-wrap text-left">${option}</span>
                    </span>
                `;

                let rightSide = '';
                if (isAnswerChecked && !isExamMode) {
                    if (isCorrect) rightSide = '<i class="fas fa-check-circle text-emerald-600 text-lg sm:text-xl"></i>';
                    else if (isSelected) rightSide = '<i class="fas fa-times-circle text-rose-600 text-lg sm:text-xl"></i>';
                }

                button.innerHTML = leftSide + rightSide;
                container.appendChild(button);
            });

            const actionBtn = document.getElementById('action-btn');
            actionBtn.classList.remove('bg-indigo-600', 'hover:bg-indigo-700', 'bg-emerald-600', 'hover:bg-emerald-700', 'bg-rose-600', 'hover:bg-rose-700');

            if (!isAnswerChecked) {
                actionBtn.innerText = isExamMode ? 'Confirm Answer' : 'Check Answer';
                actionBtn.disabled = selectedOption === null;
                actionBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
            } else {
                actionBtn.innerText = (currentIndex === questionsList.length - 1) ? 'Finish & Submit' : 'Next Question';
                actionBtn.disabled = false;
                
                if (isExamMode) {
                    actionBtn.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                } else if (selectedOption === question.answer) {
                    actionBtn.classList.add('bg-emerald-600', 'hover:bg-emerald-700');
                } else {
                    actionBtn.classList.add('bg-rose-600', 'hover:bg-rose-700');
                }
            }
        }

        function selectOption(idx) {
            if (isAnswerChecked) return;
            selectedOption = idx;
            renderQuestion();
        }

        function handleAction() {
            if (!isAnswerChecked) {
                const question = questionsList[currentIndex];
                const isCorrect = selectedOption === question.answer;
                
                if (userAnswers[currentIndex] === null) {
                    userAnswers[currentIndex] = selectedOption;
                    if (isCorrect) score++;
                    updateStats();
                }
                
                isAnswerChecked = true;
                renderQuestion();
            } else {
                const currentQ = questionsList[currentIndex];
                const isCorrect = selectedOption === currentQ.answer;

                if (!isCorrect && !isExamMode && !repeatHandled[currentIndex]) {
                    showRepeatModal();
                } else {
                    nextQuestion();
                }
            }
        }

        function nextQuestion() {
            if (currentIndex < questionsList.length - 1) {
                currentIndex++;
                const savedAnswer = userAnswers[currentIndex];
                if (savedAnswer !== null && savedAnswer !== undefined) {
                    selectedOption = savedAnswer;
                    isAnswerChecked = true;
                } else {
                    selectedOption = null;
                    isAnswerChecked = false;
                }
                renderQuestion();
            } else {
                finishQuiz();
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function prevQuestion() {
            if (currentIndex > 0) {
                currentIndex--;
                selectedOption = userAnswers[currentIndex]; 
                isAnswerChecked = true; 
                renderQuestion();
            }
        }

        function showRepeatModal() {
            document.getElementById('repeat-modal').classList.remove('hidden');
        }

        function confirmRepeat() {
            const currentQ = questionsList[currentIndex];
            repeatHandled[currentIndex] = true;
            
            questionsList.push(currentQ);
            userAnswers.push(null); 
            repeatHandled.push(false);
            
            document.getElementById('total-q-num').innerText = questionsList.length;
            document.getElementById('repeat-modal').classList.add('hidden');
            nextQuestion();
        }

        function skipRepeat() {
            repeatHandled[currentIndex] = true;
            document.getElementById('repeat-modal').classList.add('hidden');
            nextQuestion();
        }

        function updateStats() {
            if (isExamMode) return;
            document.getElementById('score-display').innerText = score;
            const answeredCount = userAnswers.filter(a => a !== null).length;
            const remaining = questionsList.length - answeredCount;
            document.getElementById('remaining-display').innerText = remaining;
            const accuracy = answeredCount > 0 ? Math.round((score / answeredCount) * 100) : 0;
            document.getElementById('accuracy-display').innerText = `${accuracy}%`;
        }

        function finishQuiz() {
            clearInterval(timerInterval);
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('results-screen').classList.remove('hidden');
            
            const answeredCount = userAnswers.filter(a => a !== null).length;
            const accuracy = answeredCount > 0 ? Math.round((score / answeredCount) * 100) : 0;
            
            document.getElementById('final-score').innerText = `${score} / ${questionsList.length}`;
            document.getElementById('final-accuracy').innerText = `${accuracy}%`;

            const statusMsg = document.getElementById('exam-status-msg');
            const resHeader = document.getElementById('results-header');
            
            if (isExamMode) {
                statusMsg.classList.remove('hidden');
                if (accuracy >= 80) {
                    statusMsg.innerText = "Distinction! You demonstrated excellent proficiency under pressure.";
                    statusMsg.className = "p-4 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-600 dark:text-emerald-400 rounded-xl border border-emerald-200 dark:border-emerald-800 text-center text-sm font-bold";
                    resHeader.className = "bg-emerald-600 dark:bg-emerald-500 p-6 sm:p-8 text-center text-white";
                } else if (accuracy >= 60) {
                    statusMsg.innerText = "Pass. You have a solid foundation, though some review is needed.";
                    statusMsg.className = "p-4 bg-indigo-50 dark:bg-indigo-900/20 text-indigo-600 dark:text-indigo-400 rounded-xl border border-indigo-200 dark:border-indigo-800 text-center text-sm font-bold";
                    resHeader.className = "bg-indigo-600 dark:bg-indigo-500 p-6 sm:p-8 text-center text-white";
                } else {
                    statusMsg.innerText = "Below Passing. We recommend revisiting the core principles of accuracy and structure.";
                    statusMsg.className = "p-4 bg-rose-50 dark:bg-rose-900/20 text-rose-600 dark:text-rose-400 rounded-xl border border-rose-200 dark:border-rose-800 text-center text-sm font-bold";
                    resHeader.className = "bg-rose-600 dark:bg-rose-500 p-6 sm:p-8 text-center text-white";
                }
            } else {
                statusMsg.classList.add('hidden');
                resHeader.className = "bg-indigo-600 dark:bg-indigo-500 p-6 sm:p-8 text-center text-white";
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleDarkMode() {
            const html = document.documentElement;
            const icon = document.getElementById('dark-mode-icon');
            if (html.classList.contains('dark')) {
                html.classList.remove('dark');
                icon.className = 'fas fa-moon text-slate-600';
            } else {
                html.classList.add('dark');
                icon.className = 'fas fa-sun text-amber-400';
            }
        }

        document.getElementById('setup-modal').classList.remove('hidden');
    </script>
</body>
</html>
